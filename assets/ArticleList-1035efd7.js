import{r as p,A as ie,_ as de,g as ue,a as pe,u as Z,m as ge,T as fe,C as ee,c as K,b as te,d as me,o as he,i as Ce,e as ye,f as be,W as xe,R as L,j as n,I as _,F as D,S as ae,B as $,h as we,k as T,l as P,n as N,p as ve,q as Se}from"./index-6607e945.js";import{D as je}from"./parser-665d9b3a.js";import{u as Ie,p as J,F as ke,P as Oe,D as Te}from"./index-c04dd974.js";import{S as ne,a as oe}from"./iconUtil-2bd23fe1.js";import{P as De}from"./PlusOutlined-6fb141d3.js";import{D as Ee}from"./index-ccb981e6.js";import{T as $e}from"./Table-f9b3c391.js";var Ae={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M505.7 661a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V168c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"download",theme:"outlined"};const Ne=Ae;var Pe=function(t,o){return p.createElement(ie,de({},t,{ref:o,icon:Ne}))};const Re=p.forwardRef(Pe),Fe=e=>{const{paddingXXS:t,lineWidth:o,tagPaddingHorizontal:a,componentCls:r,calc:m}=e,u=m(a).sub(o).equal(),C=m(t).sub(o).equal();return{[r]:Object.assign(Object.assign({},pe(e)),{display:"inline-block",height:"auto",marginInlineEnd:e.marginXS,paddingInline:u,fontSize:e.tagFontSize,lineHeight:e.tagLineHeight,whiteSpace:"nowrap",background:e.defaultBg,border:`${Z(e.lineWidth)} ${e.lineType} ${e.colorBorder}`,borderRadius:e.borderRadiusSM,opacity:1,transition:`all ${e.motionDurationMid}`,textAlign:"start",position:"relative",[`&${r}-rtl`]:{direction:"rtl"},"&, a, a:hover":{color:e.defaultColor},[`${r}-close-icon`]:{marginInlineStart:C,fontSize:e.tagIconSize,color:e.colorTextDescription,cursor:"pointer",transition:`all ${e.motionDurationMid}`,"&:hover":{color:e.colorTextHeading}},[`&${r}-has-color`]:{borderColor:"transparent",[`&, a, a:hover, ${e.iconCls}-close, ${e.iconCls}-close:hover`]:{color:e.colorTextLightSolid}},"&-checkable":{backgroundColor:"transparent",borderColor:"transparent",cursor:"pointer",[`&:not(${r}-checkable-checked):hover`]:{color:e.colorPrimary,backgroundColor:e.colorFillSecondary},"&:active, &-checked":{color:e.colorTextLightSolid},"&-checked":{backgroundColor:e.colorPrimary,"&:hover":{backgroundColor:e.colorPrimaryHover}},"&:active":{backgroundColor:e.colorPrimaryActive}},"&-hidden":{display:"none"},[`> ${e.iconCls} + span, > span + ${e.iconCls}`]:{marginInlineStart:u}}),[`${r}-borderless`]:{borderColor:"transparent",background:e.tagBorderlessBg}}},G=e=>{const{lineWidth:t,fontSizeIcon:o,calc:a}=e,r=e.fontSizeSM;return ge(e,{tagFontSize:r,tagLineHeight:Z(a(e.lineHeightSM).mul(r).equal()),tagIconSize:a(o).sub(a(t).mul(2)).equal(),tagPaddingHorizontal:8,tagBorderlessBg:e.defaultBg})},Q=e=>({defaultBg:new fe(e.colorFillQuaternary).onBackground(e.colorBgContainer).toHexString(),defaultColor:e.colorText}),re=ue("Tag",e=>{const t=G(e);return Fe(t)},Q);var Me=globalThis&&globalThis.__rest||function(e,t){var o={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(o[a]=e[a]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(o[a[r]]=e[a[r]]);return o};const Be=p.forwardRef((e,t)=>{const{prefixCls:o,style:a,className:r,checked:m,onChange:u,onClick:C}=e,g=Me(e,["prefixCls","style","className","checked","onChange","onClick"]),{getPrefixCls:s,tag:c}=p.useContext(ee),y=k=>{u==null||u(!m),C==null||C(k)},i=s("tag",o),[h,v,d]=re(i),x=K(i,`${i}-checkable`,{[`${i}-checkable-checked`]:m},c==null?void 0:c.className,r,v,d);return h(p.createElement("span",Object.assign({},g,{ref:t,style:Object.assign(Object.assign({},a),c==null?void 0:c.style),className:x,onClick:y})))}),Le=Be,_e=e=>me(e,(t,o)=>{let{textColor:a,lightBorderColor:r,lightColor:m,darkColor:u}=o;return{[`${e.componentCls}${e.componentCls}-${t}`]:{color:a,background:m,borderColor:r,"&-inverse":{color:e.colorTextLightSolid,background:u,borderColor:u},[`&${e.componentCls}-borderless`]:{borderColor:"transparent"}}}}),ze=te(["Tag","preset"],e=>{const t=G(e);return _e(t)},Q);function He(e){return typeof e!="string"?e:e.charAt(0).toUpperCase()+e.slice(1)}const B=(e,t,o)=>{const a=He(o);return{[`${e.componentCls}${e.componentCls}-${t}`]:{color:e[`color${o}`],background:e[`color${a}Bg`],borderColor:e[`color${a}Border`],[`&${e.componentCls}-borderless`]:{borderColor:"transparent"}}}},Ve=te(["Tag","status"],e=>{const t=G(e);return[B(t,"success","Success"),B(t,"processing","Info"),B(t,"error","Error"),B(t,"warning","Warning")]},Q);var Ye=globalThis&&globalThis.__rest||function(e,t){var o={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(o[a]=e[a]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(o[a[r]]=e[a[r]]);return o};const Ue=(e,t)=>{const{prefixCls:o,className:a,rootClassName:r,style:m,children:u,icon:C,color:g,onClose:s,bordered:c=!0,visible:y}=e,i=Ye(e,["prefixCls","className","rootClassName","style","children","icon","color","onClose","bordered","visible"]),{getPrefixCls:h,direction:v,tag:d}=p.useContext(ee),[x,k]=p.useState(!0),E=he(i,["closeIcon","closable"]);p.useEffect(()=>{y!==void 0&&k(y)},[y]);const I=Ce(g),A=ye(g),j=I||A,z=Object.assign(Object.assign({backgroundColor:g&&!j?g:void 0},d==null?void 0:d.style),m),b=h("tag",o),[H,V,R]=re(b),Y=K(b,d==null?void 0:d.className,{[`${b}-${g}`]:j,[`${b}-has-color`]:g&&!j,[`${b}-hidden`]:!x,[`${b}-rtl`]:v==="rtl",[`${b}-borderless`]:!c},a,r,V,R),F=f=>{f.stopPropagation(),s==null||s(f),!f.defaultPrevented&&k(!1)},[,U]=Ie(J(e),J(d),{closable:!1,closeIconRender:f=>{const S=p.createElement("span",{className:`${b}-close-icon`,onClick:F},f);return be(f,S,O=>({onClick:w=>{var X;(X=O==null?void 0:O.onClick)===null||X===void 0||X.call(O,w),F(w)},className:K(O==null?void 0:O.className,`${b}-close-icon`)}))}}),W=typeof i.onClick=="function"||u&&u.type==="a",M=C||null,q=M?p.createElement(p.Fragment,null,M,u&&p.createElement("span",null,u)):u,l=p.createElement("span",Object.assign({},E,{ref:t,className:Y,style:z}),q,U,I&&p.createElement(ze,{key:"preset",prefixCls:b}),A&&p.createElement(Ve,{key:"status",prefixCls:b}));return H(W?p.createElement(xe,{component:"Tag"},l):l)},se=p.forwardRef(Ue);se.CheckableTag=Le;const le=se;function We({value:e=[],placeholder:t="",onChange:o}){const[a,r]=L.useState(""),m=g=>{g.preventDefault(),Array.isArray(e)?o([...new Set([...e,g.target.value])]):o([g.target.value]),r("")},u=g=>{r(g.target.value)},C=g=>{o(e.filter(s=>s!==g))};return n.jsxs("div",{children:[n.jsx(_,{placeholder:t,value:a,onChange:u,onPressEnter:m}),n.jsx("div",{className:"mt-2",children:e&&e.map(g=>n.jsx(le,{bordered:!1,closable:!0,color:"blue",onClose:()=>{C(g)},children:g},g))})]})}const qe={url:[{required:!0,message:"请输入文章链接"}]};function Xe({currentRow:e,onSuccess:t,onCancel:o,rootClassName:a}){p.useState([]),p.useState([]),p.useState([]);const[r,m]=L.useState(!1),[u,C]=L.useState([]),g={status:!0},[s]=D.useForm(),c=async()=>{m(!0);const d=await T.post("/getArticle",{articleId:e.articleId});d.ok&&(d.data.categoryId==0&&(d.data.categoryId=null),s.setFieldsValue(d.data)),m(!1)},y=async()=>{const d=await T.post("/getCategoryList",{});d.ok&&C(d.data.list.map(x=>({value:x.categoryId,label:x.title})))};p.useEffect(()=>{e&&e.articleId&&c(),y()},[]);const i=async d=>{(await T.post("/addArticle",d)).ok&&(P.success({content:"添加成功"}),t())},h=async d=>{(await T.post("/updateArticle",d)).ok&&(P.success({content:"更新成功"}),t())},v=async d=>{console.log("Success:",d),m(!0),d.categoryId||(d.categoryId=0),e&&e.articleId?await h({...d,articleId:e.articleId}):await i({...d}),m(!1)};return n.jsxs(n.Fragment,{children:[n.jsxs(D,{form:s,rootClassName:a,name:"basic",labelCol:{span:4},initialValues:g,onFinish:v,autoComplete:"off",children:[n.jsx(D.Item,{label:"文章链接",name:"url",rules:qe.url,children:n.jsx(_,{placeholder:"文章链接"})}),n.jsx(D.Item,{label:"文章标题",name:"title",children:n.jsx(_,{placeholder:"文章标题"})}),n.jsx(D.Item,{label:"文章分类",name:"categoryId",children:n.jsx(ne,{allowClear:!0,placeholder:"请选择文章分类",options:u})}),n.jsx(D.Item,{label:"文章标签",name:"tags",children:n.jsx(We,{placeholder:"文章标签"})}),n.jsx(D.Item,{label:"状态",name:"status",valuePropName:"checked",children:n.jsx(oe,{})}),n.jsx(D.Item,{wrapperCol:{offset:8,span:16},children:n.jsxs(ae,{children:[n.jsx($,{onClick:o,children:"取消"}),n.jsx($,{type:"primary",htmlType:"submit",children:"保存"})]})})]}),n.jsx(we,{spinning:r,fullscreen:!0})]})}const Ke=[{title:"文章标题",dataIndex:"title",key:"title",align:"center",render:(e,t)=>n.jsx("div",{className:"text-left",children:n.jsx("a",{href:t.url,target:"_blank",children:t.title||t.url})})},{title:"分类",dataIndex:"category",key:"category",align:"center",render:(e,t)=>{var o;return n.jsx(n.Fragment,{children:((o=t.category)==null?void 0:o.title)||"-"})}},{title:"标签",dataIndex:"title",key:"title",align:"center",render:(e,t)=>{const o=t.tags||[];return n.jsx("div",{className:"text-left",children:o&&o.length>0?o.map(a=>n.jsx(le,{className:"cursor-pointer",bordered:!1,color:"blue",onClick:()=>{t.handleTagClick(a)},children:a},a)):"-"})}},{title:"创建日期",dataIndex:"createDate",key:"createDate",align:"center",render:(e,t)=>n.jsx(n.Fragment,{children:t.createDate||"-"})},{title:"状态",align:"center",dataIndex:"status",key:"status",width:100,render:(e,t)=>n.jsx(oe,{defaultChecked:t.status,onChange:o=>{t.handleStatusChange(t,o)}})},{title:"操作",align:"center",dataIndex:"taskId",key:"taskId",width:120,render:(e,t)=>n.jsxs(ae,{size:"middle",children:[n.jsx($,{type:"link",onClick:()=>{t.handleEditRow(t)},children:n.jsx(ke,{className:"cursor-pointer"})}),n.jsx(Oe,{title:"确认删除",description:"",onConfirm:()=>{t.handleDeleteRow(t)},children:n.jsx($,{danger:!0,type:"link",children:n.jsx(Te,{className:"cursor-pointer"})})})]})}];var ce={exports:{}};(function(e,t){(function(o,a){a()})(N,function(){function o(s,c){return typeof c>"u"?c={autoBom:!1}:typeof c!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),c={autoBom:!c}),c.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(s.type)?new Blob(["\uFEFF",s],{type:s.type}):s}function a(s,c,y){var i=new XMLHttpRequest;i.open("GET",s),i.responseType="blob",i.onload=function(){g(i.response,c,y)},i.onerror=function(){console.error("could not download file")},i.send()}function r(s){var c=new XMLHttpRequest;c.open("HEAD",s,!1);try{c.send()}catch{}return 200<=c.status&&299>=c.status}function m(s){try{s.dispatchEvent(new MouseEvent("click"))}catch{var c=document.createEvent("MouseEvents");c.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),s.dispatchEvent(c)}}var u=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof N=="object"&&N.global===N?N:void 0,C=u.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),g=u.saveAs||(typeof window!="object"||window!==u?function(){}:"download"in HTMLAnchorElement.prototype&&!C?function(s,c,y){var i=u.URL||u.webkitURL,h=document.createElement("a");c=c||s.name||"download",h.download=c,h.rel="noopener",typeof s=="string"?(h.href=s,h.origin===location.origin?m(h):r(h.href)?a(s,c,y):m(h,h.target="_blank")):(h.href=i.createObjectURL(s),setTimeout(function(){i.revokeObjectURL(h.href)},4e4),setTimeout(function(){m(h)},0))}:"msSaveOrOpenBlob"in navigator?function(s,c,y){if(c=c||s.name||"download",typeof s!="string")navigator.msSaveOrOpenBlob(o(s,y),c);else if(r(s))a(s,c,y);else{var i=document.createElement("a");i.href=s,i.target="_blank",setTimeout(function(){m(i)})}}:function(s,c,y,i){if(i=i||open("","_blank"),i&&(i.document.title=i.document.body.innerText="downloading..."),typeof s=="string")return a(s,c,y);var h=s.type==="application/octet-stream",v=/constructor/i.test(u.HTMLElement)||u.safari,d=/CriOS\/[\d]+/.test(navigator.userAgent);if((d||h&&v||C)&&typeof FileReader<"u"){var x=new FileReader;x.onloadend=function(){var I=x.result;I=d?I:I.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=I:location=I,i=null},x.readAsDataURL(s)}else{var k=u.URL||u.webkitURL,E=k.createObjectURL(s);i?i.location=E:location.href=E,i=null,setTimeout(function(){k.revokeObjectURL(E)},4e4)}});u.saveAs=g.saveAs=g,e.exports=g})})(ce);var Ge=ce.exports;const Qe=ve(Ge);function Je(e){const[t,o]=L.useState([]),a=async()=>{const r=await T.post("/getCategoryList",{});r.ok&&o(r.data.list.map(m=>({value:m.categoryId,label:m.title})))};return p.useEffect(()=>{a()},[]),n.jsx(ne,{style:{width:160},allowClear:!0,placeholder:"请选择文章分类",options:t,...e})}const{Search:Ze}=_,lt=()=>{const[e,t]=p.useState([]),[o,a]=p.useState(""),[r,m]=p.useState(null),[u,C]=p.useState(!0),[g,s]=p.useState(null),[c,y]=p.useState(null);P.useMessage();const i={position:["bottomCenter"],total:0,current:1,pageSize:10},[h,v]=p.useState(i),d=async()=>{v(l=>{let f={...l,current:1};return j(f),f})},x=async(l,f)=>{C(!0),(await T.post("/updateArticleStatus",{articleId:l.articleId,status:f})).ok&&P.success({content:"操作成功"}),C(!1)},k=async l=>{s(l),b(!0)},E=async l=>{C(!0),(await T.post("/deleteArticle",{articleId:l.articleId})).ok&&(P.success({content:"操作成功"}),d()),C(!1)},I=l=>{v({...i}),a(f=>(j({keyword:l}),l))},A=l=>{const f=l===void 0?c:l;return f?{startDate:f.startOf("week").startOf("day").format("YYYY-MM-DD HH:mm:ss"),endDate:f.endOf("week").endOf("day").format("YYYY-MM-DD HH:mm:ss")}:{}},j=async l=>{console.log(l);const f=A(l.week);C(!0);const S=await T.post("/getArticlePage",{pageNumber:l.current??h.current,pageSize:l.pageSize??h.pageSize,keyword:l.keyword??o,categoryId:l.categoryId??r??-1,startDate:f.startDate,endDate:f.endDate});if(S.ok){const O=S.data.list.map(w=>(w.handleStatusChange=x,w.handleEditRow=k,w.handleDeleteRow=E,w.handleTagClick=I,w.createTime&&(w.createDate=Se(w.createTime).format("YYYY-MM-DD")),w));t(O),v(w=>({...w,total:S.data.total}))}C(!1)},[z,b]=p.useState(!1),H=()=>{s(null),b(!0)},V=()=>{b(!1),d()},R=()=>{b(!1)},Y=l=>{console.log(l),v(f=>{let S={...f,...l};return j({...S}),S})},F=l=>{console.log(l),a(f=>(j({keyword:l}),l))},U=async()=>{const l=A(),f=await T.post("/renderArticle",{keyword:o,categoryId:r??-1,startDate:l.startDate,endDate:l.endDate});if(f.ok){var S=new Blob([f.data],{type:"text/plain;charset=utf-8"});Qe.saveAs(S,"Article.md")}},W=l=>{a(l.target.value)},M=l=>{console.log(l),m(f=>(j({categoryId:l||-1}),l))},q=(l,f)=>{console.log(l,f),y(S=>(j({week:l}),l))};return p.useEffect(()=>{j({...h})},[]),n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex",children:[n.jsx($,{type:"primary",onClick:H,icon:n.jsx(De,{}),children:"添加文章"}),n.jsx(Je,{className:"ml-4",value:r,onChange:M}),n.jsx(Ee,{className:"ml-4",onChange:q,picker:"week"}),n.jsx(Ze,{style:{width:"240px"},className:"ml-4",value:o,placeholder:"搜索文章标题、标签",onSearch:F,onChange:W,enterButton:!0,allowClear:!0}),n.jsx($,{className:"ml-auto",onClick:U,icon:n.jsx(Re,{}),children:"导出文章"})]}),n.jsx($e,{className:"mt-4",bordered:!0,rowKey:"articleId",loading:u,columns:Ke,dataSource:e,pagination:h,onChange:Y}),n.jsx(je,{title:g?"编辑文章":"添加文章",open:z,width:"600px",destroyOnClose:!0,onClose:R,children:n.jsx(Xe,{currentRow:g,onCancel:R,onSuccess:V})})]})};export{lt as default};
