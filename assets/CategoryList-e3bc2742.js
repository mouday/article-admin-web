import{r as o,A as V,_ as b,R as _,F as y,j as e,I as N,S as A,B as u,h as z,k as d,l as g}from"./index-4c014396.js";import{D as B}from"./parser-622d978e.js";import{a as L}from"./iconUtil-f1dfebdf.js";import{F as $,P as q,D as K}from"./index-4d431d80.js";import{T as G}from"./Table-8c8a5173.js";import{P as H}from"./PlusOutlined-cd93832f.js";var J={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M862 465.3h-81c-4.6 0-9 2-12.1 5.5L550 723.1V160c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v563.1L255.1 470.8c-3-3.5-7.4-5.5-12.1-5.5h-81c-6.8 0-10.5 8.1-6 13.2L487.9 861a31.96 31.96 0 0048.3 0L868 478.5c4.5-5.2.8-13.2-6-13.2z"}}]},name:"arrow-down",theme:"outlined"};const Q=J;var W=function(t,r){return o.createElement(V,b({},t,{ref:r,icon:Q}))};const X=o.forwardRef(W);var Y={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M868 545.5L536.1 163a31.96 31.96 0 00-48.3 0L156 545.5a7.97 7.97 0 006 13.2h81c4.6 0 9-2 12.1-5.5L474 300.9V864c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V300.9l218.9 252.3c3 3.5 7.4 5.5 12.1 5.5h81c6.8 0 10.5-8 6-13.2z"}}]},name:"arrow-up",theme:"outlined"};const Z=Y;var ee=function(t,r){return o.createElement(V,b({},t,{ref:r,icon:Z}))};const te=o.forwardRef(ee),ae={title:[{required:!0,message:"请输入分类标题"}]};function se({currentRow:n,onSuccess:t,onCancel:r,rootClassName:i}){o.useState([]),o.useState([]),o.useState([]);const[m,h]=_.useState(!1),j={status:!0},[p]=y.useForm(),f=async()=>{const l=await d.post("/getCategory",{categoryId:n.categoryId});l.ok&&p.setFieldsValue(l.data),h(!1)};o.useEffect(()=>{n&&n.categoryId&&f()},[]);const I=async l=>{(await d.post("/addCategory",l)).ok&&(g.success({content:"添加成功"}),t())},w=async l=>{(await d.post("/updateCategory",l)).ok&&(g.success({content:"更新成功"}),t())},k=async l=>{console.log("Success:",l),h(!0),n&&n.categoryId?await w({...l,categoryId:n.categoryId}):await I({...l}),h(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(y,{form:p,rootClassName:i,name:"basic",labelCol:{span:6},initialValues:j,onFinish:k,autoComplete:"off",children:[e.jsx(y.Item,{label:"分类标题",name:"title",rules:ae.title,children:e.jsx(N,{placeholder:"分类标题"})}),e.jsx(y.Item,{label:"状态",name:"status",valuePropName:"checked",children:e.jsx(L,{})}),e.jsx(y.Item,{wrapperCol:{offset:8,span:16},children:e.jsxs(A,{children:[e.jsx(u,{onClick:r,children:"取消"}),e.jsx(u,{type:"primary",htmlType:"submit",children:"保存"})]})})]}),e.jsx(z,{spinning:m,fullscreen:!0})]})}const ne=[{title:"分类名称",dataIndex:"title",key:"title",align:"center",render:(n,t)=>e.jsx("div",{className:"text-left",children:t.title})},{title:"排序",dataIndex:"orderValue",key:"orderValue",align:"center",width:100,render:(n,t,r)=>e.jsxs(e.Fragment,{children:[e.jsx(u,{type:"link",icon:e.jsx(te,{}),disabled:t.isFirst,onClick:()=>{t.handleMoveUp(r)}}),e.jsx(u,{type:"link",disabled:t.isLast,icon:e.jsx(X,{}),onClick:()=>{t.handleMoveDown(r)}})]})},{title:"状态",align:"center",dataIndex:"status",key:"status",width:100,render:(n,t)=>e.jsx(L,{defaultChecked:t.status,onChange:r=>{t.handleStatusChange(t,r)}})},{title:"操作",align:"center",dataIndex:"taskId",key:"taskId",width:120,render:(n,t)=>e.jsxs(A,{size:"middle",children:[e.jsx(u,{type:"link",onClick:()=>{t.handleEditRow(t)},children:e.jsx($,{className:"cursor-pointer"})}),e.jsx(q,{title:"确认删除",description:"",onConfirm:()=>{t.handleDeleteRow(t)},children:e.jsx(u,{danger:!0,type:"link",children:e.jsx(K,{className:"cursor-pointer"})})})]})}],ue=()=>{const[n,t]=o.useState([]),[r,i]=o.useState(!0),[m,h]=o.useState(null);g.useMessage();const[j,p]=o.useState({position:["bottomCenter"],total:0,current:1,pageSize:10}),f=async()=>{p(s=>{let a={...s,current:1};return O(),a})},I=async(s,a)=>{i(!0),(await d.post("/updateCategoryStatus",{categoryId:s.categoryId,status:a})).ok&&g.success({content:"操作成功"}),i(!1)},w=async(s,a)=>{console.log(s,a),i(!0),await d.post("/updateCategoryOrderValue",{categoryId:s.categoryId,orderValue:a.orderValue||a.categoryId}),await d.post("/updateCategoryOrderValue",{categoryId:a.categoryId,orderValue:s.orderValue||s.categoryId}),g.success({content:"操作成功"}),f(),i(!1)},k=(s,a)=>{w(s[a],s[a+1])},l=(s,a)=>{w(s[a],s[a-1])},S=async s=>{h(s),x(!0)},E=async s=>{(await d.post("/deleteCategory",{categoryId:s.categoryId})).ok&&(g.success({content:"操作成功"}),f())},O=async s=>{i(!0);const a=await d.post("/getCategoryList",{});if(a.ok){const C=a.data.list.length,T=a.data.list.map((c,F)=>(c.handleStatusChange=I,c.handleEditRow=S,c.handleDeleteRow=E,c.handleMoveUp=v=>{l(a.data.list,v)},c.handleMoveDown=v=>{k(a.data.list,v)},C==F+1?c.isLast=!0:F==0&&(c.isFirst=!0),c));t(T),p(c=>({...c,total:a.data.total}))}i(!1)},[M,x]=o.useState(!1),R=()=>{h(null),x(!0)},U=()=>{x(!1),f()},D=()=>{x(!1)},P=s=>{console.log(s),p(a=>{let C={...a,...s};return O(),C})};return o.useEffect(()=>{O()},[]),e.jsxs(e.Fragment,{children:[e.jsx(u,{type:"primary",onClick:R,icon:e.jsx(H,{}),children:"添加分类"}),e.jsx(G,{className:"mt-4",bordered:!0,rowKey:"categoryId",loading:r,columns:ne,dataSource:n,pagination:j,onChange:P}),e.jsx(B,{title:m?"编辑分类":"添加分类",open:M,destroyOnClose:!0,onClose:D,children:e.jsx(se,{currentRow:m,onCancel:D,onSuccess:U})})]})};export{ue as default};
