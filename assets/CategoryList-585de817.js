import{r,R as O,F as g,j as e,I as R,S as D,B as h,h as N,k as u,l as m}from"./index-e3aeee9e.js";import{D as L}from"./parser-62401535.js";import"./dayjs.min-a27ee3b3.js";import{a as E}from"./iconUtil-f0efbcc9.js";import{F as M,P as V,D as _}from"./index-a2b4bf63.js";import{T as z}from"./Table-d8a4db81.js";import{P as B}from"./PlusOutlined-3f2c3822.js";const q={title:[{required:!0,message:"请输入分类标题"}]};function v({currentRow:a,onSuccess:t,onCancel:p,rootClassName:l}){r.useState([]),r.useState([]),r.useState([]);const[y,i]=O.useState(!1),j={status:!0},[c]=g.useForm(),f=async()=>{const s=await u.post("/getCategory",{categoryId:a.categoryId});s.ok&&c.setFieldsValue(s.data),i(!1)};r.useEffect(()=>{a&&a.categoryId&&f()},[]);const k=async s=>{(await u.post("/addCategory",s)).ok&&(m.success({content:"添加成功"}),t())},I=async s=>{(await u.post("/updateCategory",s)).ok&&(m.success({content:"更新成功"}),t())},S=async s=>{console.log("Success:",s),i(!0),a&&a.categoryId?await I({...s,categoryId:a.categoryId}):await k({...s}),i(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(g,{form:c,rootClassName:l,name:"basic",labelCol:{span:6},initialValues:j,onFinish:S,autoComplete:"off",children:[e.jsx(g.Item,{label:"分类标题",name:"title",rules:q.title,children:e.jsx(R,{placeholder:"分类标题"})}),e.jsx(g.Item,{label:"状态",name:"status",valuePropName:"checked",children:e.jsx(E,{})}),e.jsx(g.Item,{wrapperCol:{offset:8,span:16},children:e.jsxs(D,{children:[e.jsx(h,{onClick:p,children:"取消"}),e.jsx(h,{type:"primary",htmlType:"submit",children:"保存"})]})})]}),e.jsx(N,{spinning:y,fullscreen:!0})]})}const A=[{title:"分类名称",dataIndex:"title",key:"title",align:"center",render:(a,t)=>e.jsx("div",{className:"text-left",children:t.title})},{title:"状态",align:"center",dataIndex:"status",key:"status",width:100,render:(a,t)=>e.jsx(E,{defaultChecked:t.status,onChange:p=>{t.handleStatusChange(t,p)}})},{title:"操作",align:"center",dataIndex:"taskId",key:"taskId",width:120,render:(a,t)=>e.jsxs(D,{size:"middle",children:[e.jsx(h,{type:"link",onClick:()=>{t.handleEditRow(t)},children:e.jsx(M,{className:"cursor-pointer"})}),e.jsx(V,{title:"确认删除",description:"",onConfirm:()=>{t.handleDeleteRow(t)},children:e.jsx(h,{danger:!0,type:"link",children:e.jsx(_,{className:"cursor-pointer"})})})]})}],X=()=>{const[a,t]=r.useState([]),[p,l]=r.useState(!0),[y,i]=r.useState(null);m.useMessage();const[j,c]=r.useState({position:["bottomCenter"],total:0,current:1,pageSize:10}),f=async()=>{c(n=>{let o={...n,current:1};return s(),o})},k=async(n,o)=>{l(!0),(await u.post("/updateCategoryStatus",{categoryId:n.categoryId,status:o})).ok&&m.success({content:"操作成功"}),l(!1)},I=async n=>{i(n),x(!0)},S=async n=>{(await u.post("/deleteCategory",{categoryId:n.categoryId})).ok&&(m.success({content:"操作成功"}),f())},s=async n=>{l(!0);const o=await u.post("/getCategoryList",{});if(o.ok){const C=o.data.list.map(d=>(d.handleStatusChange=k,d.handleEditRow=I,d.handleDeleteRow=S,d));t(C),c(d=>({...d,total:o.data.total}))}l(!1)},[w,x]=r.useState(!1),b=()=>{i(null),x(!0)},P=()=>{x(!1),f()},F=()=>{x(!1)},T=n=>{console.log(n),c(o=>{let C={...o,...n};return s(),C})};return r.useEffect(()=>{s()},[]),e.jsxs(e.Fragment,{children:[e.jsx(h,{type:"primary",onClick:b,icon:e.jsx(B,{}),children:"添加分类"}),e.jsx(z,{className:"mt-4",bordered:!0,rowKey:"categoryId",loading:p,columns:A,dataSource:a,pagination:j,onChange:T}),e.jsx(L,{title:y?"编辑分类":"添加分类",open:w,destroyOnClose:!0,onClose:F,children:e.jsx(v,{currentRow:y,onCancel:F,onSuccess:P})})]})};export{X as default};
