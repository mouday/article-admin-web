import{d as O,e as V,f as z,R as b,C as D,i as $,o as W,y as A,h as B,k as H,j as l,u as I,B as J,r as p,l as M,n as U,b as X}from"./index-5ef596df.js";import{C as q}from"./ContainerOutlined-e2cd4dc5.js";import{d as v}from"./dayjs.min-6f790ae0.js";import{R as E,S as Q}from"./iconUtil-2f327d62.js";import{T as Y}from"./Table-acd71fb6.js";const L=["wrap","nowrap","wrap-reverse"],N=["flex-start","flex-end","start","end","center","space-between","space-around","space-evenly","stretch","normal","left","right"],P=["center","start","end","flex-start","flex-end","self-start","self-end","baseline","normal","stretch"],Z=(t,e)=>{const s={};return L.forEach(a=>{s[`${t}-wrap-${a}`]=e.wrap===a}),s},K=(t,e)=>{const s={};return P.forEach(a=>{s[`${t}-align-${a}`]=e.align===a}),s[`${t}-align-stretch`]=!e.align&&!!e.vertical,s},tt=(t,e)=>{const s={};return N.forEach(a=>{s[`${t}-justify-${a}`]=e.justify===a}),s};function et(t,e){return O(Object.assign(Object.assign(Object.assign({},Z(t,e)),K(t,e)),tt(t,e)))}const st=t=>{const{componentCls:e}=t;return{[e]:{display:"flex","&-vertical":{flexDirection:"column"},"&-rtl":{direction:"rtl"},"&:empty":{display:"none"}}}},at=t=>{const{componentCls:e}=t;return{[e]:{"&-gap-small":{gap:t.flexGapSM},"&-gap-middle":{gap:t.flexGap},"&-gap-large":{gap:t.flexGapLG}}}},nt=t=>{const{componentCls:e}=t,s={};return L.forEach(a=>{s[`${e}-wrap-${a}`]={flexWrap:a}}),s},rt=t=>{const{componentCls:e}=t,s={};return P.forEach(a=>{s[`${e}-align-${a}`]={alignItems:a}}),s},lt=t=>{const{componentCls:e}=t,s={};return N.forEach(a=>{s[`${e}-justify-${a}`]={justifyContent:a}}),s},ot=()=>({}),ct=V("Flex",t=>{const{paddingXS:e,padding:s,paddingLG:a}=t,o=z(t,{flexGapSM:e,flexGap:s,flexGapLG:a});return[st(o),at(o),nt(o),rt(o),lt(o)]},ot,{resetStyle:!1});var it=globalThis&&globalThis.__rest||function(t,e){var s={};for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&e.indexOf(a)<0&&(s[a]=t[a]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,a=Object.getOwnPropertySymbols(t);o<a.length;o++)e.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(t,a[o])&&(s[a[o]]=t[a[o]]);return s};const ut=b.forwardRef((t,e)=>{const{prefixCls:s,rootClassName:a,className:o,style:w,flex:m,gap:g,children:y,vertical:f=!1,component:S="div"}=t,C=it(t,["prefixCls","rootClassName","className","style","flex","gap","children","vertical","component"]),{flex:c,direction:x,getPrefixCls:h}=b.useContext(D),i=h("flex",s),[T,j,k]=ct(i),n=f??(c==null?void 0:c.vertical),u=O(o,a,c==null?void 0:c.className,i,j,k,et(i,t),{[`${i}-rtl`]:x==="rtl",[`${i}-gap-${g}`]:$(g),[`${i}-vertical`]:n}),r=Object.assign(Object.assign({},c==null?void 0:c.style),w);return m&&(r.flex=m),g&&!$(g)&&(r.gap=g),T(b.createElement(S,Object.assign({ref:e,className:u,style:r},W(C,["justify","wrap","align"])),y))}),dt=ut,d={TaskStatusStartError:1,TaskStatusStartSuccess:2,TaskStatusStartRun:3,TaskStatusRunning:4,TaskStatusRunningSuccess:5,TaskStatusRunningError:6},G=[{label:"启动成功",value:d.TaskStatusStartSuccess,color:A[6]},{label:"运行成功",value:d.TaskStatusRunningSuccess,color:B[6]},{label:"运行失败",value:d.TaskStatusRunningError,color:H[5]}];function gt({record:t}){const e=I({pathname:`/task-log/${t.taskLogId}`}),s=()=>{window.open(e,"_blank")};return l.jsx(J,{type:"link",disabled:!t.hasRunLog,onClick:s,children:l.jsx(q,{})})}const ft=[{title:"标题",dataIndex:"title",key:"title",align:"center"},{title:"状态",dataIndex:"status",key:"status",width:100,align:"center",render:(t,e)=>{const s=G.find(a=>a.value===e.status);return l.jsx("span",{style:{color:s==null?void 0:s.color},children:s==null?void 0:s.label})}},{title:"开始时间",dataIndex:"createTime",key:"createTime",width:200,align:"center"},{title:"结束时间",dataIndex:"endTime",key:"endTime",width:200,align:"center",render:(t,e)=>e.endTime?l.jsx("span",{children:e.endTime}):l.jsx(l.Fragment,{children:"-"})},{title:"耗时（秒）",dataIndex:"diffTime",key:"diffTime",width:120,align:"center",render:(t,e)=>l.jsx("span",{children:e.diffTime})},{title:"日志",key:"action",align:"center",width:80,render:(t,e)=>l.jsx(gt,{record:e})}],yt=()=>{const[t,e]=p.useState([]),[s,a]=p.useState(!0);M();const[o,w]=U(),m=o.get("taskId"),g=!1;I({pathname:"/task-log"});const[y,f]=p.useState(null),[S,C]=p.useState(0),[c,x]=p.useState({position:["bottomCenter"],total:0,current:1,pageSize:10}),h=async n=>{a(!0);const u=await X.getTaskLogList({page:n.current,size:n.pageSize,status:n.status,taskId:m});u.ok&&(e(u.data.list.map(r=>{r.isComplete=[d.TaskStatusStartError,d.TaskStatusRunningSuccess,d.TaskStatusRunningError].includes(r.status);const R=v(r.createTime),F=v(r.endTime),_=v();return r.endTime?r.diffTime=F.diff(R,"seconds"):r.diffTime=_.diff(R,"seconds"),r.hasRunLog=[d.TaskStatusStartRun,d.TaskStatusRunning,d.TaskStatusRunningSuccess,d.TaskStatusRunningError].includes(r.status),r})),x(r=>({...r,total:u.data.total}))),a(!1)};p.useEffect(()=>(h(c),()=>{clearInterval(y)}),[]);const i=n=>{console.log(n),x(u=>{let r={status:S,...u,...n};return h(r),r})},T=n=>{console.log(n.target.value),i({status:n.target.value}),C(n.target.value)},j=[{value:0,label:"全部"},...G],k=n=>{console.log(n),f(n?u=>setInterval(()=>{i()},1e3*3):u=>(clearInterval(u),null))};return l.jsxs(l.Fragment,{children:[l.jsxs(dt,{justify:"space-between",children:[l.jsx(E.Group,{value:S,buttonStyle:"solid",onChange:T,children:j.map(n=>l.jsx(E.Button,{value:n.value,children:n.label},n.value))}),l.jsxs("div",{className:"flex items-center",children:[l.jsx("span",{className:"mr-2",children:"定时刷新"}),l.jsx(Q,{defaultChecked:g,onChange:k})]})]}),l.jsx(Y,{className:"mt-4",bordered:!0,loading:s,columns:ft,rowKey:"taskLogId",dataSource:t,pagination:c,onChange:i})]})};export{yt as default};
